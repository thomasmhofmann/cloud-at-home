= Goal
Run a Kubernetes Cluster on a (small) machine at home.

Run workloads like:

* Unify Control Center
* Homeassitent
* GitLab
* CodeServer

= Setup

* Fedora (35) as operating system
* k3s as Kubernetes distribution
* Longhorn for persistent storage
* 1Password Secrets Automation for storing secrets
* Traefik using LetsEncrypt

== k3s
https://rancher.com/docs/k3s/latest/en/[Documentation^]

----
curl -sfL https://get.k3s.io | sh -
----

== Longhorn
https://longhorn.io/docs/1.2.2/advanced-resources/os-distro-specific/csi-on-k3s/[Documentation^]

https://rancher.com/docs/k3s/latest/en/storage/[Install via kubectl^]:

----
kubectl apply -f https://raw.githubusercontent.com/longhorn/longhorn/master/deploy/longhorn.yaml
----

== 1Password Secrets Automation
https://support.1password.com/connect-deploy-kubernetes[Setup^]
https://github.com/1Password/connect-helm-charts[Helm Repository^]
https://github.com/1Password/connect-helm-charts/tree/main/charts/connect[Details on the Connect Server and Operator^]
https://github.com/1Password/onepassword-operator[Operator]
https://github.com/1Password/onepassword-operator#usage[CRD Description]

https://helm.sh/docs/intro/install/#from-script[Install Helm^]

----
$ helm repo add 1password https://1password.github.io/connect-helm-charts
----

----
kubectl create namespace 1password
kns 1password
helm install connect 1password/connect --set-file connect.credentials=./1password-credentials.json --set operator.create=true --set operator.token.value=<token>
----

https://1password.community/discussion/125401/unable-to-get-item-from-vault[First problem encounterd^]

DNS issues:
----
[thofmann@w530 ~]$ k exec onepassword-connect-54c545fd75-qzs9v -c connect-sync -- bash -c 'openssl s_client -crlf -connect my.ent.1password.com:443 -servername my.ent.1password.com'
140261671187584:error:2008F002:BIO routines:BIO_lookup_ex:system lib:../crypto/bio/b_addr.c:724:Temporary failure in name resolution
connect:errno=11
command terminated with exit code 1
----

== Traefik
https://doc.traefik.io/traefik/[Documentation^]
https://doc.traefik.io/traefik/https/acme/[Documentation on ACME^]
